# TUW-CCgen (TU Wien Covert Channel generator)

- *... 2020, FM*
- *Sep 2021, FIV*


## Introduction 

The TUW-CCgen is a tool for creating, transmitting, and retreiving covert channels into TCP/IP features. 

TUW-CCgen has two operation modi: (a) **online**, in which covert channels are generated on-the-fly and transmitted to an aimed destination address, and (b) **offline**, in which covert channels are injected into existing flows of pcap captures. It also shows two operation roles: (1) **injector**, which creates and/or injects a covert channel, and (2) **extractor**, which receives and/or discloses a covert channel. 

Hence, four different operational behaviours are possible:
(a1) online injector, 
(a2) online extractor, 
(b1) offline injector, 
(b2) offline extractor.

## Calling TUW-CCgen

Depending on the desired operational behaviour, TUW-CCgen accepts the following calls from a terminal:

- Online injector:

        $ python3 ccgen.py online inject <configuration_file>

- Online extractor:

        $ python3 ccgen.py online extract <configuration_file>

- Offline injector:

        $ python3 ccgen.py offline inject <configuration_file>

- Offline extractor:

        $ python3 ccgen.py offline extract <configuration_file>


## Configuration file

The configuration file is a plain TEXT file divided into three blocks (an example model is provided in *example/config.ini*): 

`[Files]` contains information about the files to use as inputs and outputs for the injection or extraction of the covert channel. It includes the following fields:

- `input:` the original pcap to read. 
- `output:` the pcap generated by TUW-CCgen with the injected covert channel.
- `message:` the path to the binary message text file
- `mapping:` the path to the mapping file. This file contains the relationship between the message and the field (e.g., each 8 bits of the message are mapped into 16 bits of source port). For examples on how the file should look like, refer to the `MappingFiles` directory. For timing, this represents the time between packets.

`[Filter]`
        * src_ip**: 
packets with this source ip will be considered for injecting
* dst_ip**: packets with this destination ip will be considered for injecting
* src_port**: packets with this source port will be considered for injecting
* dst_port**: packets with this destination port will be considered for injecting
* proto**: packets with this protocol will be considered for injecting

        [Channel]

* technique: technique that will be used for injecting. The techniques are implemented in the `techniques` directory
* bits: slice the message into x bits (this should be compatible with the mapping used)
* layer: layer where the covert channel is injected (IP, TCP or UDP). Generally IP should work in all cases.

**: These parameters are not required and can be used separately e.g., filtering only for a certain protocol or all packets going to one destination ip etc.

In addition to the configuration file, you will need a few other files:
* Text file containing the message to be injected in binary (8-bits ascii -- similar to `message.txt` https://www.binaryhexconverter.com/binary-to-ascii-text-converter)
* Clean pcap (only in offline mode)
* A mapping file (can be copied from `MappingFiles`

## Offline Mode
In offline mode, you will inject/decode a given message inside a given pcap.

### Inject
Create an empty folder, copy your clean pcap inside, create a text file with the binary message and copy the template configuration file `ccgen_offline.cfg`
Modify the `ccgen_offline.cfg` with the parameters explained above based on your needs (lines with # at the beginning are ignored)

Once you have all files, run the following:
```python2 ccgen.py network offline direction send configfile <path_to_config_file>```

This should create a new pcap `output` with the covert channel inside.

PS: currently the script runs only with python2

### Decode
If you have a pcap and want to recover the injected message use the same configuration file but swap the input and output pcap names and type the following:
```python2 ccgen.py network offline direction receive configfile <path_to_config_file>```

## Online Mode
For online mode, the same configuration above applies. The only difference is the run command:
```python2 ccgen.py network online direction send configfile <path_to_config_file>```

In addition, to run the covert channel continuously (send the same message again and again), you might want to check our utility to run the script in a loop: `../infrastructure/cc_controller.py`

## Complete example
In `example.zip` you can find a folder that contains everything you need to inject a message in TTL. You can run `python2 ../ccgen.py network offline direction send configfile cc.ini` from inside the folder to inject a covert channel.

## Implement new techniques and mappings
Once you understand how everything up to now works, you can add your own MappingFiles to the source folder and utilize them afterwards.
If a new technique has to be implemented, you should put the respective python script in `techniques`. Each technique script has the same structure (which also helps in case one wants to debug something). Each technique is a python class with two principal methods: modify (that takes a mapped value and injects it into the respective field) and an extract (which does the reverse thing).

## Help
If you questions, want to improve something or bug fixes please contact fares.meghdouri@tuwien.ac.at

## Additional Information (from old README)
ccgen.py is a very early draft of a covert channel generator
ccgen.cfg is an example config file for the generator.
message.txt is an example covert message. In general, ccgen.py expects that the covert channel message file consists of exactly one line of zeroes and ones.

the techniques directory contains python files of which each implements a certain covert technique.

the two pcap files can be used for testing:
  small.pcap is a part of a tcp connection (from ftp://ftp.bro-ids.org/enterprise-traces/hdr-traces05/tcp_public3.pcap)
  tor.pcap consists of some packets from my tor connection


FOR TIMING, please enter the time to wait in seconds

MappingFiles contains some example mapping files

